<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניפטי - משחק החנויות שמשגע את המדינה!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <meta property="og:title" content="ניפטי - משחק החנויות שמשגע את המדינה!">
    <meta property="og:description" content="הקימו חנות טלגרם אישית בקלות, התחילו להרוויח עוד היום והצטרפו למהפכה הדיגיטלית!">
    <meta property="og:image" content="https://osifeu-prog.github.io/my-shop-landing/nifty_logo.png?v=2">
    <meta property="og:url" content="https://osifeu-prog.github.io/my-shop-landing/">
    <meta property="og:type" content="website">
    <meta property="og:image:width" content="500">
    <meta property="og:image:height" content="500">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://osifeu-prog.github.io/my-shop-landing/nifty_logo.png?v=2">

    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --accent-color: #6f42c1;
            --text-color: #343a40;
            --light-text: #f8f9fa;
            --bg-color-light: #f8f9fa;
            --bg-color-dark: #212529;
            --gradient-light: linear-gradient(135deg, #e0f2f7, #c6e7f2);
            --gradient-dark: linear-gradient(135deg, #1f2733, #0a0e14);
        }
        body {
            font-family: 'Heebo', 'Inter', sans-serif;
            direction: rtl;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color-light);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            text-align: right;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        .hero-section {
            text-align: center;
            padding: 100px 20px;
            background: var(--gradient-light);
            border-bottom-left-radius: 70px;
            border-bottom-right-radius: 70px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 10% 20%, rgba(0, 123, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 90% 80%, rgba(40, 167, 69, 0.1) 0%, transparent 50%);
            animation: bg-animate 20s infinite alternate;
        }
        @keyframes bg-animate {
            0% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            100% { transform: scale(1.1) rotate(5deg); opacity: 1; }
        }
        .hero-content {
            position: relative;
            z-index: 2;
        }
        .hero-section h1 {
            font-size: 3.5em;
            font-weight: 900;
            color: var(--primary-color);
            margin: 0 0 15px 0;
            animation: fadeInDown 1s ease-out;
        }
        .hero-section p {
            font-size: 1.4em;
            color: var(--text-color);
            max-width: 700px;
            margin: 0 auto 30px auto;
            animation: fadeInUp 1.5s ease-out;
        }
        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            animation: zoomIn 1s ease-out 1.2s forwards;
            opacity: 0;
        }
        .cta-button {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 30px;
            font-weight: 700;
            font-size: 1.1em;
            border-radius: 50px;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .cta-button.telegram-bot {
            background-color: var(--primary-color);
        }
        .cta-button.registration-bot {
            background-color: var(--accent-color);
        }
        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        .cta-button.telegram-bot:hover {
            background-color: #0056b3;
        }
        .cta-button.contact-me:hover {
            background-color: #218838;
        }
        .cta-button.registration-bot:hover {
            background-color: #5d34a5;
        }
        .section {
            padding: 80px 0;
            text-align: center;
        }
        .section-title {
            font-size: 2.5em;
            font-weight: 900;
            color: var(--accent-color);
            margin-bottom: 50px;
            position: relative;
            animation: fadeInDown 1s ease-out;
        }
        .section-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 5px;
            background: var(--primary-color);
            margin: 15px auto 0;
            border-radius: 5px;
        }
        .content-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            text-align: right;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1s ease-out forwards;
            opacity: 0;
        }
        .content-box.dark-summary {
            background-color: var(--bg-color-dark);
            color: var(--light-text);
        }
        .content-box p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        .content-box strong {
            color: var(--primary-color);
        }
        .content-box.dark-summary strong {
             color: var(--secondary-color);
        }
        .grid-container {
            display: grid;
            gap: 30px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        .grid-item {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
            animation: zoomIn 1s ease-out forwards;
            opacity: 0;
        }
        .grid-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        .grid-item h3 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.3em;
            margin-top: 0;
        }
        .grid-item p {
            color: #555;
        }
        .recruitment-section .grid-item h3 {
            color: var(--secondary-color);
        }
        .testimonials-section {
            padding: 80px 0;
            text-align: center;
        }
        .testimonial-grid {
            display: grid;
            gap: 30px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            justify-content: center;
        }
        .testimonial-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            text-align: right;
            transition: transform 0.3s ease;
            animation: fadeInUp 1s ease-out forwards;
            opacity: 0;
        }
        .testimonial-card:hover {
            transform: translateY(-5px);
        }
        .testimonial-card .quote {
            font-size: 1.1em;
            font-style: italic;
            margin-bottom: 15px;
            color: #555;
        }
        .testimonial-card .author {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 10px;
        }
        .testimonial-card .bot-link {
            display: block;
            margin-top: 10px;
            color: var(--secondary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .testimonial-card .bot-link:hover {
            color: var(--primary-color);
        }
        .testimonial-card .bot-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #777;
            margin-top: 5px;
        }
        .testimonial-card .bot-info .bot-name {
            font-weight: bold;
        }

        .image-section {
            padding: 50px 0;
            text-align: center;
        }
        .main-image {
            width: 100%;
            max-width: 500px;
            height: auto;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transition: transform 0.5s ease-in-out;
            animation: zoomIn 1.5s ease-out forwards;
            opacity: 0;
        }
        .main-image:hover {
            transform: scale(1.05);
        }

        /* Referral Contest Section */
        .referral-contest-section {
            padding: 80px 0;
            background-color: var(--bg-color-dark);
            color: var(--light-text);
            text-align: center;
        }
        .referral-contest-section h2 {
            color: var(--secondary-color);
        }
        .referral-link-box {
            background-color: #343a40;
            padding: 20px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 600px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }
        #referral-link-text {
            color: var(--light-text);
            font-family: monospace;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-grow: 1;
        }
        .copy-button {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        .copy-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .leaderboard-container {
            margin-top: 40px;
            background-color: #343a40;
            padding: 20px;
            border-radius: 15px;
            max-width: 600px;
            margin: 40px auto 0;
        }
        .leaderboard-container h3 {
            color: var(--light-text);
            font-size: 1.5em;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #495057;
        }
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        .leaderboard-item .rank {
            font-weight: bold;
            color: var(--accent-color);
        }
        .leaderboard-item .user-id {
            font-family: monospace;
            font-size: 0.9em;
            direction: ltr; /* Ensure left-to-right for user IDs */
        }
        .leaderboard-item .count {
            font-weight: bold;
            color: var(--secondary-color);
        }
        /* New Styles for Contest Pages */
        canvas {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 1.5rem;
            width: 100%;
            height: 500px;
        }
        .dynamic-points {
            font-family: 'Courier New', Courier, monospace;
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a90e2;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        .share-button {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* Animations */
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 768px) {
            .hero-section h1 { font-size: 2.5em; }
            .hero-section p { font-size: 1.1em; }
            .cta-buttons { flex-direction: column; gap: 15px; }
            .cta-button { width: 80%; margin: 0 auto; }
            .section-title { font-size: 2em; }
        }
    </style>
</head>
<body>
    <div id="success-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm mx-auto text-center border-t-4 border-green-500 transform transition-all scale-95 opacity-0 duration-300">
            <div class="text-green-500 text-5xl mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">נרשמת בהצלחה!</h2>
            <p class="text-gray-600 mb-4">שיהיה בהצלחה בתחרות. כעת תוכל לשתף את הקישור שלך כדי לצבור נקודות.</p>
            <button onclick="closeModal('success-modal')" class="bg-blue-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-600 transition-colors">סגור</button>
        </div>
    </div>
    
    <div id="share-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm mx-auto text-center border-t-4 border-blue-500 transform transition-all scale-95 opacity-0 duration-300">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">שתף את הקישור שלך</h2>
            <p class="text-gray-600 mb-4">העתק את הקישור הבלעדי שלך ושתף אותו עם חברים כדי לזכות בנקודות!</p>
            <div class="flex items-center space-x-2 bg-gray-100 p-3 rounded-lg mb-4">
                <input id="share-link-input" type="text" readonly class="flex-grow bg-transparent text-gray-700 font-mono text-sm border-none outline-none">
                <button onclick="copyToClipboard()" class="text-blue-500 hover:text-blue-600 transition-colors">
                    <i class="far fa-copy"></i>
                </button>
            </div>
            <button onclick="closeModal('share-modal')" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-300 transition-colors">סגור</button>
        </div>
    </div>

    <header class="hero-section">
        <div class="hero-content">
            <h1>ניפטי - משחק החנויות שמשגע את המדינה!</h1>
            <p>ברוכים הבאים לעולם של ניפטי - המקום שבו החלום על קניון אישי הופך למציאות. בניפטי, אנו מאמינים שלכל אחד ואחת מגיע להקים עסק משלו, בקלות וביעילות. הצטרפו למהפכה הדיגיטלית החדשה והתחילו להרוויח עוד היום.</p>
            <div class="cta-buttons">
                <a href="https://t.me/Buy_My_Shop_bot" target="_blank" class="cta-button telegram-bot">
                    <i class="fab fa-telegram-plane"></i> כנסו לחנות שלי בטלגרם
                </a>
                <a href="https://t.me/OsifFin" target="_blank" class="cta-button contact-me">
                    <i class="fas fa-comments"></i> דברו איתי ישירות
                </a>
            </div>
        </div>
    </header>

    <main>
        <section class="section what-is-nifty">
            <div class="container">
                <h2 class="section-title">מה זה ניפטי?</h2>
                <div class="content-box">
                    <p><strong>ניפטי</strong> הוא משחק וחוויה עסקית שמאפשרת לכם להקים חנות אישית משלכם בטלגרם. כל שעליכם לעשות הוא לבחור את המוצרים שתרצו למכור, לעצב את חלון הראווה שלכם ולשתף את החנות עם חברים ולקוחות. ככל שהחנות שלכם תצבור יותר ביקורים ומכירות, כך תעלו בדירוג וצפו לפרסים והפתעות מרגשים!</p>
                </div>
            </div>
        </section>

        <section class="image-section">
            <div class="container">
                <img src="https://osifeu-prog.github.io/my-shop-landing/assets/image-of-app.png" alt="תמונה של האפליקציה בטלפון" class="main-image">
            </div>
        </section>

        <section class="section how-it-works">
            <div class="container">
                <h2 class="section-title">איך זה עובד?</h2>
                <div class="grid-container">
                    <div class="grid-item">
                        <i class="fas fa-store fa-3x mb-4 text-accent-color"></i>
                        <h3>1. פתחו חנות בקליק</h3>
                        <p>התחילו את המסע שלכם על ידי הקמת חנות טלגרם אישית תוך דקות ספורות. ללא צורך בידע טכני או ניסיון קודם.</p>
                    </div>
                    <div class="grid-item">
                        <i class="fas fa-share-alt fa-3x mb-4 text-primary-color"></i>
                        <h3>2. שתפו עם חברים</h3>
                        <p>שתפו את הקישור לחנות שלכם עם חברים ומשפחה וקבלו נקודות על כל הפניה. ככל שתשתפו יותר, כך תצברו יותר נקודות.</p>
                    </div>
                    <div class="grid-item">
                        <i class="fas fa-trophy fa-3x mb-4 text-secondary-color"></i>
                        <h3>3. קנו וזכו בפרסים</h3>
                        <p>השתמשו בנקודות שצברתם כדי להשתתף בתחרויות שבועיות ולקנות מוצרים יוקרתיים בחנות המיוחדת של ניפטי.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="section profit-section">
            <div class="container">
                <h2 class="section-title">איך אני מרוויח כסף?</h2>
                <div class="content-box dark-summary">
                    <p>בניפטי, הרווח שלכם לא מגיע רק ממכירת מוצרים בחנות שלכם. פיתחנו מודל ייחודי שמאפשר לכם להרוויח כסף מכל חנות שהקמתם, <strong>גם מבלי למכור בעצמכם!</strong></p>
                    <p>
                        על ידי שיתוף החנות שלכם וגיוס משתמשים חדשים, אתם בונים רשת של חנויות שכולן מחוברות אליכם. <strong>מכל מכירה שמתבצעת ברשת שלכם, אתם זוכים באחוזים מכל עסקה!</strong>
                    </p>
                    <p>ככל שהרשת שלכם גדולה ופעילה יותר, כך הרווחים שלכם גדלים באופן אקספוננציאלי. ניפטי הוא לא רק משחק, זו הזדמנות אמיתית לבנות עסק פסיבי משלך.</p>
                </div>
            </div>
        </section>

        <section class="section testimonials-section">
            <div class="container">
                <h2 class="section-title">מה אומרים השחקנים?</h2>
                <div id="testimonials-container" class="testimonial-grid">
                    </div>
            </div>
        </section>

        <section class="section recruitment-section">
            <div class="container">
                <h2 class="section-title">הצטרפו לתחרות והתחילו להרוויח!</h2>
                <div class="content-box">
                    <p>התחרו על פרסים מדהימים כמו סופ"ש זוגי, ערכות גיימינג ועוד! כל מה שצריך לעשות הוא להביא כמה שיותר חברים, ולנצח!</p>
                    <a href="#registration-section" class="inline-block bg-purple-600 text-white font-bold py-2 px-6 rounded-full hover:bg-purple-700 transition-colors">
                        לפרטים נוספים והרשמה
                    </a>
                </div>
            </div>
        </section>

        <section class="section contest-details-section p-6 md:p-12">
            <main class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden p-6 md:p-10 lg:p-16">
                <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-4">תחרות השיתופים נושאת פרסים והפתעות!</h1>
                    <p class="text-lg text-gray-600">קבלו את כל הפרטים על התחרות הכי משתלמת של הקיץ.</p>
                </header>

                <section class="mb-8 space-y-6">
                    <div class="bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">איך התחרות עובדת?</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>הירשמו לתחרות בעמוד הראשי.</li>
                            <li>קבלו קישור ייחודי ואישי.</li>
                            <li>שתפו את הקישור עם כמה שיותר חברים.</li>
                            <li>על כל חבר שיירשם דרך הקישור שלכם, תקבלו נקודה אחת.</li>
                            <li>החבר שהבאתם יקבל גם הוא קישור ייחודי, ונקודות על כל מי שיביא.</li>
                        </ul>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">מהם הפרסים?</h2>
                        <p class="text-gray-700">הפרסים יחולקו למקומות הראשונים:</p>
                        <ul class="mt-4 space-y-2 text-gray-700 font-bold">
                            <li><span class="text-yellow-500">מקום ראשון:</span> סוף שבוע זוגי מפנק בצימר יוקרתי!</li>
                            <li><span class="text-gray-500">מקום שני:</span> כרטיס מתנה בשווי 500 ש"ח לחנות מוצרי אלקטרוניקה.</li>
                            <li><span class="text-amber-700">מקום שלישי:</span> ערכת גיימינג מקצועית.</li>
                            <li><span class="text-gray-400">מקומות 4-10:</span> חנות דיגיטלית מעוצבת ומוכנה למכירה.</li>
                        </ul>
                    </div>
                </section>
            </main>
        </section>

        <section class="section referral-contest-dashboard-section p-6 md:p-12">
            <main class="max-w-7xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden p-6 md:p-10 lg:p-16">
                <header class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-2">תחרות השיתופים הגדולה!</h1>
                    <p class="text-lg text-gray-600">הירשמו, שתפו והביאו הכי הרבה חברים כדי לנצח.</p>
                </header>

                <section id="registration-section" class="mb-10 p-6 md:p-8 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">הצטרפו לתחרות!</h2>
                    <p id="referrer-info" class="text-center text-sm text-gray-500 mb-4 hidden"></p>
                    <form id="registration-form" class="space-y-4 max-w-md mx-auto">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">שם מלא</label>
                            <input type="text" id="name" name="name" placeholder="השם שלך" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="profilePic" class="block text-sm font-medium text-gray-700 mb-1">קישור לתמונת פרופיל</label>
                            <input type="url" id="profilePic" name="profilePic" placeholder="העתק קישור של תמונה (לדוגמה: Imgur, Google Photos)" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <button type="submit" id="register-button" class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                            <span id="button-text">הירשם לתחרות</span>
                            <span id="button-loading" class="hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </form>
                </section>

                <section id="dashboard-section" class="hidden space-y-8">
                    <div class="bg-blue-500 text-white rounded-2xl p-6 md:p-8 text-center shadow-lg">
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">הלוח שלך, <span id="user-name"></span></h2>
                        <div class="text-4xl md:text-5xl font-extrabold dynamic-points mb-4">
                            <span id="user-points">0</span>
                            <span class="text-2xl font-normal">נקודות</span>
                        </div>
                        <p class="text-sm">הקישור הייחודי שלך: <span id="user-id-display" class="font-bold text-yellow-300 text-sm"></span></p>
                        <button onclick="openModal('share-modal')" class="bg-white text-blue-500 font-bold py-2 px-6 rounded-full mt-4 hover:bg-gray-100 transition-colors share-button">
                            <i class="fas fa-share-alt mr-2"></i> שתף קישור
                        </button>
                    </div>
                
                    <div class="p-6 md:p-8 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">מפת ההפניות האינטראקטיבית</h2>
                        <p class="text-sm text-gray-500 mb-4">לכל חבר שהבאת יש קשר ישיר אליך. כל חבר שהם מביאים מוסיף שורה נוספת לרשת שלך.</p>
                        <canvas id="referral-map"></canvas>
                    </div>
                
                    <div class="p-6 md:p-8 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">פיד משתמשים ודירוג</h2>
                        <p id="loading-users" class="text-center text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i>טוען משתמשים...</p>
                        <div id="users-container" class="space-y-6">
                            </div>
                    </div>
                </section>
            </main>
        </section>

        <section class="referral-contest-section">
            <div class="container">
                <h2 class="section-title">הצטרפו לתחרות ההפניות!</h2>
                <p>הביאו חברים וטפסו על לוח הדירוג כדי לזכות בפרסים מדהימים!</p>
                
                <div class="referral-link-box">
                    <span id="referral-link-text">טוען קישור הפניה...</span>
                    <button id="copy-button" class="copy-button">
                        <i class="fas fa-copy"></i> העתק קישור
                    </button>
                </div>
                
                <div class="leaderboard-container">
                    <h3>לוח דירוג מובילים</h3>
                    <div id="leaderboard">
                        </div>
                </div>
            </div>
        </section>

    </main>

    <footer>
        </footer>

    <script type="module">
        import { initializeApp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, where, getDocs, orderBy, getCountFromServer, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables
        let user;
        let isNewUser = false;
        let referrerId = null;
        let userProfileData = null;
        const urlParams = new URLSearchParams(window.location.search);

        const config = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Elements from index.html
        const copyButton = document.getElementById('copy-button');
        const referralLinkTextElement = document.getElementById('referral-link-text');
        const leaderboardElement = document.getElementById('leaderboard');
        const testimonialsContainer = document.getElementById('testimonials-container');

        // UI Elements from Contest.html
        const registrationForm = document.getElementById('registration-form');
        const registrationSection = document.getElementById('registration-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const userNameDisplay = document.getElementById('user-name');
        const userPointsDisplay = document.getElementById('user-points');
        const userIdDisplay = document.getElementById('user-id-display');
        const referrerInfo = document.getElementById('referrer-info');
        const registerButton = document.getElementById('register-button');
        const buttonText = document.getElementById('button-text');
        const buttonLoading = document.getElementById('button-loading');
        const usersContainer = document.getElementById('users-container');
        const loadingUsers = document.getElementById('loading-users');
        const referralMapCanvas = document.getElementById('referral-map');

        // Modals
        const successModal = document.getElementById('success-modal');
        const shareModal = document.getElementById('share-modal');
        const shareLinkInput = document.getElementById('share-link-input');

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('div').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('div').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        window.openModal = openModal;
        window.closeModal = closeModal;

        // Unified copy to clipboard
        async function copyToClipboard() {
            const linkText = shareLinkInput.value;
            try {
                await navigator.clipboard.writeText(linkText);
                console.log('Link copied successfully!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        }
        window.copyToClipboard = copyToClipboard;

        // Handle URL parameters for referrals
        referrerId = urlParams.get('referrer');
        if (referrerId) {
            referrerInfo.textContent = `נרשם על ידי: ${referrerId}`;
            referrerInfo.classList.remove('hidden');
        }

        // --- Core Functions ---

        async function initFirebase() {
            try {
                // Check if user is already signed in
                onAuthStateChanged(auth, async (currentUser) => {
                    if (currentUser) {
                        user = currentUser;
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) {
                            isNewUser = false;
                            userProfileData = userDoc.data();
                            console.log("Existing user logged in:", userProfileData);
                            displayDashboard(userProfileData);
                            initializeReferralTracking();
                        } else {
                            // User is signed in but not registered
                            isNewUser = true;
                            displayRegistrationForm();
                        }
                    } else {
                        // Not signed in, attempt anonymous sign-in
                        const result = await signInAnonymously(auth);
                        user = result.user;
                        isNewUser = true;
                        console.log("Signed in anonymously. This is a new user.");
                        displayRegistrationForm();
                    }
                });
            } catch (error) {
                console.error("Error with authentication:", error);
            }
        }

        function displayRegistrationForm() {
            registrationSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
        }

        function displayDashboard(profile) {
            registrationSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');

            userNameDisplay.textContent = profile.name;
            userIdDisplay.textContent = profile.userId;
            referralLinkTextElement.textContent = `https://your-website.com/?referrer=${profile.userId}`;
            shareLinkInput.value = `https://your-website.com/?referrer=${profile.userId}`;

            // Listen for real-time updates to user points
            onSnapshot(doc(db, "users", profile.userId), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const userData = docSnapshot.data();
                    userPointsDisplay.textContent = userData.referralCount || 0;
                }
            });
            drawReferralMap(); // Draw the map on dashboard display
        }

        async function registerUser(name, profilePic) {
            buttonText.classList.add('hidden');
            buttonLoading.classList.remove('hidden');

            try {
                const userId = user.uid;
                const userRef = doc(db, 'users', userId);
                const userDoc = await getDoc(userRef);

                if (!userDoc.exists()) {
                    await setDoc(userRef, {
                        userId: userId,
                        name: name,
                        profilePic: profilePic,
                        referralCount: 0,
                        referrer: referrerId
                    });

                    // Update referrer's count
                    if (referrerId) {
                        const referrerRef = doc(db, 'users', referrerId);
                        const referrerDoc = await getDoc(referrerRef);
                        if (referrerDoc.exists()) {
                            await updateDoc(referrerRef, {
                                referralCount: (referrerDoc.data().referralCount || 0) + 1
                            });
                        }
                    }

                    userProfileData = { userId, name, profilePic, referralCount: 0, referrer: referrerId };
                    displayDashboard(userProfileData);
                    openModal('success-modal');

                } else {
                    console.warn("User already registered. Displaying dashboard.");
                    userProfileData = userDoc.data();
                    displayDashboard(userProfileData);
                }

            } catch (error) {
                console.error("Error during registration:", error);
            } finally {
                buttonText.classList.remove('hidden');
                buttonLoading.classList.add('hidden');
            }
        }

        // Event listener for registration form
        registrationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const profilePic = document.getElementById('profilePic').value;
            await registerUser(name, profilePic);
        });

        // Testimonials and Leaderboard (from index.html)
        function initializeReferralTracking() {
            const testimonialsQuery = collection(db, 'testimonials');
            const leaderboardQuery = query(collection(db, 'users'), orderBy('referralCount', 'desc'));

            // Load Testimonials
            onSnapshot(testimonialsQuery, (querySnapshot) => {
                testimonialsContainer.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const item = doc.data();
                    const testimonialCard = document.createElement('div');
                    testimonialCard.className = 'testimonial-card';
                    testimonialCard.innerHTML = `
                        <p class="quote">"${item.testimonial}"</p>
                        <div class="author-info">
                            <span class="author">-${item.author}</span>
                            <span class="bot-info">
                                <span class="bot-name">(@${item.botName})</span>
                            </span>
                            <a href="${item.botLink}" target="_blank" class="bot-link">כנסו לחנות שלו</a>
                        </div>
                    `;
                    testimonialsContainer.appendChild(testimonialCard);
                });
            }, (error) => {
                console.error("Error listening to testimonials:", error);
            });

            // Load Leaderboard
            onSnapshot(leaderboardQuery, (querySnapshot) => {
                leaderboardElement.innerHTML = '';
                const users = [];
                querySnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                if (users.length > 0) {
                    users.forEach((item, index) => {
                        const leaderboardItem = document.createElement('div');
                        leaderboardItem.className = 'leaderboard-item';
                        leaderboardItem.innerHTML = `
                            <span class="rank">#${index + 1}</span>
                            <span class="user-id">${item.name}</span>
                            <span class="count">${item.referralCount}</span>
                        `;
                        leaderboardElement.appendChild(leaderboardItem);
                    });
                }
            }, (error) => {
                console.error("Error listening to leaderboard:", error);
            });

            // Copy button logic
            copyButton.addEventListener('click', () => {
                const link = referralLinkTextElement.textContent;
                const tempInput = document.createElement('input');
                tempInput.value = link;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand('copy');
                    console.log('Referral link copied to clipboard!');
                    copyButton.textContent = 'הועתק!';
                    setTimeout(() => {
                        copyButton.innerHTML = '<i class="fas fa-copy"></i> העתק קישור';
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
                document.body.removeChild(tempInput);
            });
        }
        
        // Referral Map (from Contest.html)
        async function drawReferralMap() {
            if (!user) return;

            const canvas = referralMapCanvas;
            const ctx = canvas.getContext('2d');
            let width = canvas.offsetWidth;
            let height = canvas.offsetHeight;
            canvas.width = width;
            canvas.height = height;

            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            ctx.font = '14px Heebo, sans-serif';
            ctx.textAlign = 'center';

            const myUser = userProfileData;

            const levels = { 0: [myUser] };
            let queue = [myUser];
            let level = 1;

            const maxUsersPerLevel = 10;
            const fetchedUsers = {};

            const usersQuery = query(collection(db, 'users'), where('referrer', '==', myUser.userId));
            const childSnapshot = await getDocs(usersQuery);

            levels[level] = childSnapshot.docs.map(doc => doc.data());
            queue = queue.concat(levels[level]);

            while (queue.length > 0 && level < 4) { // Limit depth to avoid infinite loops
                const parent = queue.shift();
                
                if (parent.userId === myUser.userId) {
                    // This is the root user
                    // Children are already in levels[1]
                } else {
                    const childrenQuery = query(collection(db, 'users'), where('referrer', '==', parent.userId));
                    const childrenSnapshot = await getDocs(childrenQuery);
                    const children = childrenSnapshot.docs.map(doc => doc.data());

                    if (children.length > 0) {
                        level++;
                        if (!levels[level]) levels[level] = [];
                        levels[level] = levels[level].concat(children);
                        queue = queue.concat(children);
                    }
                }
            }

            const levelSpacing = 100;
            let y = 50;

            for (const lvl in levels) {
                const usersInLevel = levels[lvl];
                const totalUsers = usersInLevel.length;
                const xSpacing = width / (totalUsers + 1);

                y += levelSpacing;

                for (let i = 0; i < totalUsers; i++) {
                    const user = usersInLevel[i];
                    const x = (i + 1) * xSpacing;
                    const yPos = y;

                    ctx.beginPath();
                    ctx.arc(x, yPos, 25, 0, Math.PI * 2);
                    ctx.fillStyle = '#6f42c1';
                    ctx.fill();
                    ctx.strokeStyle = '#4a90e2';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Draw name
                    ctx.fillStyle = '#333';
                    ctx.fillText(user.name, x, yPos + 35);
                    ctx.fillText(`${user.referralCount} נק' `, x, yPos + 50);
                }
            }
        }
        window.onresize = drawReferralMap;

        // Start everything
        initFirebase();
    </script>
</body>
</html>
